<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>å…¨å›½æˆ¿ç§Ÿç¨è´¹è®¡ç®—å™¨ï¼ˆ2025ç‰ˆï¼‰</title>
  <style>
    :root { --pri:#07c160; --mut:#666; --bg:#f7f7f7; --card:#fff; }
    body { margin:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; background:var(--bg); color:#111;}
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
    .header { margin: 8px 0 16px; }
    .title { font-size: 20px; font-weight: 700; }
    .subtitle { color: var(--mut); font-size: 13px; margin-top: 6px; }
    .card { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,.04); }
    .field { margin: 10px 0; }
    label { display:block; font-size: 14px; margin-bottom: 6px; }
    input, select, button { width: 100%; padding: 12px; border:1px solid #ddd; border-radius:10px; font-size: 15px; }
    button { background: var(--pri); color: #fff; border: none; font-weight: 600; }
    button:disabled { opacity: .6; }
    .row { display:flex; gap:12px; }
    .row .col { flex:1; }
    .result { margin-top: 16px; }
    .result .item { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px dashed #eee; }
    .result .item:last-child { border-bottom: none; }
    .mut { color: var(--mut); font-size: 12px; }
    .divider { height: 1px; background:#eee; margin:16px 0; }
    .cta { display:flex; flex-direction:column; gap:10px; }
    .btn-outline { background:#fff; color:var(--pri); border:1px solid var(--pri); }
    .ad-mask { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:999; }
    .ad-box { width: min(92vw, 480px); background:#fff; border-radius:14px; padding:16px; text-align:center; }
    .ad-title { font-weight:700; margin-bottom:6px; }
    .ad-img { width:100%; height:160px; background:#eee; border-radius:10px; margin:10px 0; display:flex; align-items:center; justify-content:center; color:#999; }
    .ad-actions { display:flex; gap:10px; margin-top:10px;}
    .foot { color:#888; font-size:12px; line-height:1.6; margin-top:16px; }
    a { color:#2b6cb0; text-decoration:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">å…¨å›½æˆ¿ç§Ÿç¨è´¹è®¡ç®—å™¨ï¼ˆ2025ç‰ˆï¼‰</div>
      <div class="subtitle">åŸºäºå…¨å›½ç®€æ˜“è®¡ç¨æ–¹æ¡ˆï¼šä½å®…3%ï¼Œéä½å®…5%ï¼›æŸ¥è´¦å¾æ”¶å·®å¼‚è¾ƒå¤§ï¼Œæš‚ä¸æä¾›è®¡ç®—ã€‚</div>
    </div>

    <div class="card">
      <div class="row">
        <div class="col field">
          <label>æœˆç§Ÿé‡‘ï¼ˆå…ƒï¼‰</label>
          <input id="rent" type="number" min="0" placeholder="ä¾‹å¦‚ 5000" />
        </div>
        <div class="col field">
          <label>æˆ¿å±‹ç±»å‹</label>
          <select id="houseType">
            <option value="residential">ä½å®…ï¼ˆ3%ï¼‰</option>
            <option value="non_residential">éä½å®…ï¼ˆ5%ï¼‰</option>
          </select>
        </div>
      </div>

      <button id="calcBtn">è®¡ç®—</button>

      <div id="result" class="result" style="display:none;">
        <div class="divider"></div>
        <div class="item"><span>æˆ¿äº§ç¨ï¼ˆçº¦ï¼‰</span><b id="propTax">-</b></div>
        <div class="item"><span>ä¸ªäººæ‰€å¾—ç¨ï¼ˆçº¦ï¼‰</span><b id="incTax">-</b></div>
        <div class="item"><span>åˆè®¡ç¨è´¹</span><b id="totalTax">-</b></div>
        <div class="mut" style="margin-top:8px;">æç¤ºï¼šæœ¬é¡µé¢é‡‡ç”¨å…¨å›½ç®€æ˜“è®¡ç¨æ–¹æ¡ˆã€‚å®é™…ç¨ç‡å¯èƒ½éšåœ°åŒºå£å¾„ç•¥æœ‰è°ƒæ•´ã€‚</div>
      </div>

      <div class="divider"></div>

      <div class="cta">
        <button id="freeLawBtn" class="btn-outline">å…è´¹è·å–å¾‹å¸ˆå»ºè®®ï¼ˆåˆåŒé£æ§ä¸èŠ‚ç¨è¦ç‚¹ï¼‰</button>
        <div id="leadTips" class="mut" style="display:none;">
          ğŸ‘‰ å·²ä¸ºä½ å‡†å¤‡äº¤æµç¾¤ä¸æŒ‡å¼•ï¼š<br/>
          â€¢ ç¾¤é“¾æ¥ï¼š<a target="_blank" href="https://weixin.qq.com/xxxxx">ç‚¹å‡»åŠ å…¥å¾®ä¿¡ç¾¤</a><br/>
          â€¢ æˆ–æ·»åŠ å¾®ä¿¡ï¼š<b>Lawyer-XXXX</b> å¤‡æ³¨â€œç§ŸèµèŠ‚ç¨â€
        </div>
        <button id="paidBtn">è·å–è¯¦ç»†èŠ‚ç¨æ–¹æ¡ˆ Â¥100</button>
      </div>

      <div class="divider"></div>

      <div class="foot">
        <b>å…è´£å£°æ˜</b><br/>
        1. æœ¬å·¥å…·ä»…ä¾›å‚è€ƒï¼Œå®é™…åº”çº³ç¨é¢ä»¥ç¨åŠ¡æœºå…³æ ¸å®šä¸ºå‡†ã€‚<br/>
        2. æœ¬è®¡ç®—åŸºäºå…¨å›½ç®€æ˜“è®¡ç¨æ–¹æ¡ˆï¼ˆä½å®…3%ï¼Œéä½å®…5%ï¼‰ã€‚<br/>
        3. æŸ¥è´¦å¾æ”¶æ–¹å¼ï¼ˆæ®å®å¾æ”¶ï¼‰å„åœ°å·®å¼‚å¤§ï¼Œæœ¬å·¥å…·æš‚ä¸æä¾›è®¡ç®—ã€‚<br/>
        4. å‡ºç§Ÿäººåº”ä¾æ³•å¦‚å®ç”³æŠ¥çº³ç¨å¹¶ä¿å­˜ç›¸å…³å‡­è¯ã€‚<br/>
        5. æ¡ä¾‹åŸæ–‡ï¼š<a target="_blank" href="https://www.gov.cn/zhengce/zhengceku/202507/content_7032956.htm">å›½åŠ¡é™¢ä»¤ç¬¬812å·ã€Šä½æˆ¿ç§Ÿèµæ¡ä¾‹ã€‹</a>
      </div>
    </div>
  </div>

  <!-- å¹¿å‘Šå ä½ï¼ˆæ— å¹¿å‘Šæ—¶ä¸å±•ç¤ºï¼‰ -->
  <div id="adMask" class="ad-mask">
    <div class="ad-box">
      <div class="ad-title">èµåŠ©å†…å®¹</div>
      <div class="ad-img">å¹¿å‘Šä½ï¼ˆ2ç§’åè‡ªåŠ¨æ˜¾ç¤ºç»“æœï¼‰</div>
      <div class="ad-actions">
        <button id="skipAd" class="btn-outline" style="flex:1;">è·³è¿‡</button>
        <button id="adLearn" style="flex:1;">äº†è§£æ›´å¤š</button>
      </div>
      <div class="mut" id="countdown" style="margin-top:6px;">2 ç§’</div>
    </div>
  </div>

  <script>
    // å¹¿å‘Šå¼€å…³ï¼ˆæ— å¹¿å‘Šï¼šè®¾ä¸º falseï¼‰
    const ADS_ENABLED = true;

    const rentEl = document.getElementById('rent');
    const typeEl = document.getElementById('houseType');
    const calcBtn = document.getElementById('calcBtn');
    const resultBox = document.getElementById('result');
    const propEl = document.getElementById('propTax');
    const incEl  = document.getElementById('incTax');
    const totalEl= document.getElementById('totalTax');

    const adMask = document.getElementById('adMask');
    const skipAd = document.getElementById('skipAd');
    const adLearn= document.getElementById('adLearn');
    const countdown = document.getElementById('countdown');

    const freeLawBtn = document.getElementById('freeLawBtn');
    const leadTips = document.getElementById('leadTips');
    const paidBtn = document.getElementById('paidBtn');

    function showToast(msg){
      alert(msg);
    }

    async function doCalc() {
      const rent = Number(rentEl.value);
      const houseType = typeEl.value;
      if (!rent || rent <= 0) {
        showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æœˆç§Ÿé‡‘');
        return;
      }
      calcBtn.disabled = true;

      try {
        const res = await fetch('/api/tax/calc-simple', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ monthlyRent: rent, houseType })
        });
        const data = await res.json();
        if (data.code !== 0) {
          throw new Error(data.msg || 'è®¡ç®—å¤±è´¥');
        }
        const r = data.data;
        propEl.textContent = r.propertyTax.toFixed(2) + ' å…ƒ';
        incEl.textContent = r.incomeTax.toFixed(2) + ' å…ƒ';
        totalEl.textContent = r.totalTax.toFixed(2) + ' å…ƒ';
        resultBox.style.display = 'block';
      } catch (e) {
        showToast(e.message || 'è¯·æ±‚å¤±è´¥');
      } finally {
        calcBtn.disabled = false;
      }
    }

    // å¹¿å‘Šæµç¨‹ï¼šæœ‰å¹¿å‘Šåˆ™å…ˆå±•ç¤º 2 ç§’ï¼›å¦åˆ™ç›´æ¥è®¡ç®—
    calcBtn.addEventListener('click', async () => {
      if (!ADS_ENABLED) {
        doCalc();
        return;
      }
      adMask.style.display = 'flex';
      let left = 2;
      countdown.textContent = left + ' ç§’';
      const timer = setInterval(() => {
        left -= 1;
        countdown.textContent = Math.max(left,0) + ' ç§’';
        if (left <= 0) {
          clearInterval(timer);
          adMask.style.display = 'none';
          doCalc();
        }
      }, 1000);

      skipAd.onclick = () => {
        clearInterval(timer);
        adMask.style.display = 'none';
        doCalc();
      };
      adLearn.onclick = () => {
        window.open('https://example.com/ads', '_blank');
      };
    });

    // å¼•æµï¼šå…è´¹å»ºè®® â†’ å±•ç¤ºç¾¤é“¾æ¥ä¸è¯´æ˜
    freeLawBtn.addEventListener('click', () => {
      leadTips.style.display = 'block';
      // TODO: å¯åœ¨æ­¤å¤„ä¸ŠæŠ¥åŸ‹ç‚¹ /api/lead-track
    });

    // ä»˜è´¹å…¥å£
    paidBtn.addEventListener('click', () => {
      // è¿™é‡Œå¯æ›¿æ¢ä¸ºä½ çš„æ”¶æ¬¾é¡µ/å¾®ä¿¡æ”¯ä»˜æ‹‰èµ·é¡µ
      window.open('https://example.com/pay?product=tax-plan&price=100', '_blank');
    });
  </script>
</body>
</html>
