<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>全国房租税费计算器（2025版）</title>
  <style>
    :root { --pri:#07c160; --mut:#666; --bg:#f7f7f7; --card:#fff; }
    body { margin:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; background:var(--bg); color:#111;}
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
    .header { margin: 8px 0 16px; }
    .title { font-size: 20px; font-weight: 700; }
    .subtitle { color: var(--mut); font-size: 13px; margin-top: 6px; }
    .card { background: var(--card); border-radius: 12px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,.04); }
    .field { margin: 10px 0; }
    label { display:block; font-size: 14px; margin-bottom: 6px; }
    input, select, button { width: 100%; padding: 12px; border:1px solid #ddd; border-radius:10px; font-size: 15px; }
    button { background: var(--pri); color: #fff; border: none; font-weight: 600; }
    button:disabled { opacity: .6; }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .row .col { flex:1; min-width: 140px; }
    .result { margin-top: 16px; }
    .result .item { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px dashed #eee; }
    .result .item:last-child { border-bottom: none; }
    .mut { color: var(--mut); font-size: 12px; }
    .divider { height: 1px; background:#eee; margin:16px 0; }
    .cta { display:flex; flex-direction:column; gap:10px; }
    .btn-outline { background:#fff; color:var(--pri); border:1px solid var(--pri); }
    .foot { color:#888; font-size:12px; line-height:1.6; margin-top:16px; }
    a { color:#2b6cb0; text-decoration:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">全国房租税费计算器（2025版）</div>
      <div class="subtitle">基于全国简易计税方案：住宅房产税4%，个税10%；非住宅税率示例可调整。</div>
    </div>

    <div class="card">
      <div class="row">
        <div class="col field">
          <label>月租金（元）</label>
          <input id="rent" type="number" min="0" placeholder="例如 5000" />
        </div>
        <div class="col field">
          <label>房屋类型</label>
          <select id="houseType">
            <option value="residential">住宅（房产税4%，个税10%）</option>
            <option value="non_residential">非住宅（示例房产税12%，个税20%）</option>
          </select>
        </div>
      </div>

      <div class="field">
        <label><input type="checkbox" id="propDeduction" /> 房产税扣除800元修缮费</label>
        <label><input type="checkbox" id="incDeduction" /> 个税扣除800元租金</label>
      </div>

      <button id="calcBtn">计算</button>

      <div id="result" class="result" style="display:none;">
        <div class="divider"></div>
        <div class="item"><span>房产税（约 / 月）</span><b id="propTax">-</b></div>
        <div class="item"><span>个人所得税（约 / 月）</span><b id="incTax">-</b></div>
        <div class="item"><span>合计税费（约 / 月）</span><b id="totalTax">-</b></div>
        <div class="mut" style="margin-top:8px;">提示：低于等于800元时可全额免税，扣除选项会影响基数。</div>
      </div>

      <div class="divider"></div>

      <div class="cta">
        <button id="freeLawBtn" class="btn-outline">免费获取律师建议</button>
        <div id="leadTips" class="mut" style="display:none;">
          👉 添加律师微信：<b>Martcoser</b> 备注“租赁节税”<br/>
          或扫码进群（长按保存）：<br/>
          <img src="/group-qrcode.png" alt="微信群二维码" style="width:160px;height:160px;" />
        </div>
        <button id="paidBtn">进入详细节税方案付费群 ¥100</button>
      </div>

      <div class="divider"></div>

      <div class="foot">
        <b>免责声明</b><br/>
        1. 本工具仅供参考，实际应纳税额以税务机关核定为准。<br/>
        2. 本计算基于全国简易计税方案示例。<br/>
        3. 出租人应依法如实申报纳税并保存相关凭证。<br/>
      </div>
    </div>
  </div>

  <script>
    const rentEl = document.getElementById('rent');
    const typeEl = document.getElementById('houseType');
    const calcBtn = document.getElementById('calcBtn');
    const resultBox = document.getElementById('result');
    const propEl = document.getElementById('propTax');
    const incEl  = document.getElementById('incTax');
    const totalEl= document.getElementById('totalTax');
    const propDeductionEl = document.getElementById('propDeduction');
    const incDeductionEl = document.getElementById('incDeduction');

    const freeLawBtn = document.getElementById('freeLawBtn');
    const leadTips = document.getElementById('leadTips');
    const paidBtn = document.getElementById('paidBtn');

    function showToast(msg){
      alert(msg);
    }

    async function doCalc() {
      const rent = Number(rentEl.value);
      const houseType = typeEl.value;
      const propDeduction = propDeductionEl.checked;
      const incDeduction = incDeductionEl.checked;

      if (!rent || rent <= 0) {
        showToast('请输入有效的月租金');
        return;
      }
      calcBtn.disabled = true;

      try {
        const res = await fetch('/api/tax/calc-simple', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ monthlyRent: rent, houseType, propDeduction, incDeduction })
        });
        const data = await res.json();
        if (data.code !== 0) {
          throw new Error(data.msg || '计算失败');
        }
        const r = data.data;
        propEl.textContent = r.propertyTax.toFixed(2) + ' 元';
        incEl.textContent = r.incomeTax.toFixed(2) + ' 元';
        totalEl.textContent = r.totalTax.toFixed(2) + ' 元';
        resultBox.style.display = 'block';
      } catch (e) {
        showToast(e.message || '请求失败');
      } finally {
        calcBtn.disabled = false;
      }
    }

    calcBtn.addEventListener('click', doCalc);

    freeLawBtn.addEventListener('click', () => {
      leadTips.style.display = 'block';
    });

    paidBtn.addEventListener('click', () => {
      window.open('https://example.com/pay?product=tax-plan&price=100', '_blank');
    });
  </script>
</body>
</html>
